#!/usr/bin/python3
import os
import subprocess
import threading
import time
import requests
from main.tools import banner,run_on_browser,WEB_Application_Analysis,waiting
from bs4 import BeautifulSoup

def main():
    while True:
        os.system("clear")
        banner.main()
        banner.attack("Vulnerability Analysis")
        list_attacks=["Wpscan","Wireshark","Wapiti","Nmap","Legion","Nikto","go back"]
        for i in range(len(list_attacks)):
            print(f"{i}) {list_attacks[i]}")

        option = input("\n Select an option ->  ")
        if option=="0":
            print("\n[+] Wpscan")
            os.system("clear")
            Wpscan()
        elif option=="1":
            print("\n[+] Wireshark")
            os.system("clear")
            Wireshark()
        elif option=="2":
            print("\n[+] Wapiti")
            os.system("clear")
            WEB_Application_Analysis.Wapiti()
        elif option=="3":
            print("\n[+] Nmap")
            os.system("clear")
            Nmap()
        elif option=="4":
            print("\n[+] Legion")
            os.system("clear")
            Legion()
        elif option=="5":
            print("\n[+] Nikto")
            os.system("clear")
            Nikto()
        else:
            return

def Wireshark():
    os.system("clear")
    banner.main()
    banner.attack("Wireshark")
    github=github_getting_text("https://github.com/wireshark/wireshark",'p[dir="auto"]',0)
    banner.description(github.strip())
    print('\n')
    ask=tool_writeups()
    if ask=="1":
        check_installed("wireshark",False)
        waiting.waiting()
    elif ask=="2":
        writeup({'How To Install & Use Wireshark On Kali Linux':'https://infosecscout.com/wireshark-on-kali-linux/','Wireshark Tool Documentation':'https://www.kali.org/tools/wireshark/','Wireshark Training':'https://www.wireshark.org/docs/','Wireshark – Resources':'https://blog.inf.ed.ac.uk/atate/2023/01/14/wireshark-resources/','Kerberos Wireshark Captures: A Windows Login Example':'https://medium.com/@robert.broeckelmann/kerberos-wireshark-captures-a-windows-login-example-151fabf3375a','Wireshark – Packet Capturing and Analyzing':'https://www.geeksforgeeks.org/wireshark-packet-capturing-and-analyzing/','https://unit42.paloaltonetworks.com/wireshark-tutorial-decrypting-https-traffic/':'https://unit42.paloaltonetworks.com/wireshark-tutorial-decrypting-https-traffic/'},'Wireshark')
    else:
        return

#you need to make a downlaod function for anger ip scanner
def Wpscan():
    os.system("clear")
    banner.main()
    banner.attack("Wpscan")
    banner.description("WPScan is a security scanner designed for testing the security of websites built using WordPress. WPScan was developed using the Ruby programming language and then released in the first version in 2019. The WPScan security scanner is primarily intended to be used by WordPress administrators and security teams to assess the security status of their WordPress installations. It is used to scan WordPress websites for known vulnerabilities both in WordPress and commonly used WordPress plugins and themes. The code base for WPScan is licensed under GPLv3")
    print('\n')
    ask=tool_writeups()
    if ask=="1":
        check_installed("wpscan",True)
        waiting.waiting()
    elif ask=="2":
        writeup({'WPScan Intro: How to Scan for WordPress Vulnerabilities':'https://blog.sucuri.net/2021/05/wpscan-how-to-scan-for-wordpress-vulnerabilities.html/','WPScan:WordPress Pentesting Framework':'https://www.hackingarticles.in/wpscanwordpress-pentesting-framework/','How To Use WPScan to Test for Vulnerable Plugins and Themes in Wordpress':"https://www.digitalocean.com/community/tutorials/how-to-use-wpscan-to-test-for-vulnerable-plugins-and-themes-in-wordpress","How to Use wpscan tool in Kali Linux":"https://www.geeksforgeeks.org/how-to-use-wpscan-tool-in-kali-linux/","WPScan Usage Example [Enumeration + Exploit]":"https://www.cyberpunk.rs/wpscan-usage-example"},"Wpscan Writeup")
    else:
        return

def Nmap():
    os.system("clear")
    banner.main()
    banner.attack("Nmap")
    github=github_getting_text("https://nmap.org/",'p',1)
    banner.description(github.strip())
    print('\n')
    ask=tool_writeups()
    if ask=="1":
        check_installed("nmap","no-help")
        waiting.waiting()
    elif ask=="2":
        writeup({'NMAP Cheat Sheet':'https://www.tutorialspoint.com/nmap-cheat-sheet','Nmap Cheat Sheet 2023: All the Commands, Flags & Switches':'https://www.stationx.net/nmap-cheat-sheet/','NMAP CHEAT-SHEET (Nmap Scanning Types, Scanning Commands , NSE Scripts)':'https://infosecsanyam.medium.com/nmap-cheat-sheet-nmap-scanning-types-scanning-commands-nse-scripts-868a7bd7f692','Network Scanning by Nmap':'https://auntoracharja.medium.com/network-scanning-by-nmap-74e2b5789e82',},'Nmap')
    else:
        return

def Legion():
    os.system("clear")
    banner.main()
    banner.attack("Legion")
    github=github_getting_text("https://github.com/GoVanguard/legion",'p[class="f4 my-3"]',0)
    banner.description(github.strip())
    print('\n')
    ask=tool_writeups()
    if ask=="1":
        check_installed("legion",False)
        waiting.waiting()
    elif ask=="2":
        writeup({'Legion Tool in Kali Linux':'https://www.geeksforgeeks.org/legion-tool-in-kali-linux','Legion -- Test Web Application Vulnerability Automatically':'https://www.kalilinux.in/2020/09/legion-kali-linux.html','How to use Legion application in Kali Linux | Information Gathering':'https://www.youtube.com/watch?v=5UAfXbP5Y0k'},'Nikto')
    else:
        return

def Nikto():
    os.system("clear")
    banner.main()
    banner.attack("Nikto")
    github=github_getting_text("https://en.wikipedia.org/wiki/Nikto_(vulnerability_scanner)",'p',1)
    banner.description(github.strip())
    print('\n')
    ask=tool_writeups()
    if ask=="1":
        check_installed("nikto",True)
        waiting.waiting()
    elif ask=="2":
        writeup({'What is Nikto and it’s usages ?':'https://www.geeksforgeeks.org/what-is-nikto-and-its-usages/','Nikto: A Practical Website Vulnerability Scanner':'https://securitytrails.com/blog/nikto-website-vulnerability-scanner','Nikto Official Docs':'https://github.com/sullo/nikto/wiki'},'Nikto')
    else:
        return

def check_installed(name,needargs=False):
    file = open('/dev/null')
    proc = subprocess.Popen([f"dpkg -s {name}"], stdout=subprocess.PIPE, shell=True,stderr=file)
    #there keyfor success output and noththere for error output
    (there, notthere) = proc.communicate()
    if "install ok installed" not in there.decode():
                print("[-] not installed")
                print("[+] it is not installed in your Kali")
                download=input("[+] Do you want to install it?(y/n)")
                if download=="y" or download=="Y" or download=="Yes" or download=="yes":
                    os.system(f"sudo apt install {name} -y")
                    if needargs:
                        download=input("Do you want to run the tool?(y/n)")
                        if download=="y" or download=="Y" or download=="Yes" or download=="yes":
                            #when tool is of cli no need of thread
                            thread_run(name,needargs)
                    else:
                        download=input("Do you want to run the tool?(y/n)")
                        if download=="y" or download=="Y" or download=="Yes" or download=="yes":
                            #when tool is of gui it needs thread
                            threading.Thread(target=thread_run, args=(name,)).start()
    else:
                print("[+] Installed")
                print("[+] it is installed in your kali")
                if needargs:
                        download=input("Do you want to run the tool?(y/n)")
                        if download=="y" or download=="Y" or download=="Yes" or download=="yes":
                            #when tool is of cli no need of thread
                            thread_run(name,needargs)
                else:
                        download=input("Do you want to run the tool?(y/n)")
                        if download=="y" or download=="Y" or download=="Yes" or download=="yes":
                            #when tool is of gui it needs thread
                            threading.Thread(target=thread_run, args=(name,)).start()


def thread_run(command,needargs=False):
    if needargs=="no-help":
        #it will run only help because it is in cli
        os.system(f"{command}")
    elif needargs:
        os.system(f"{command} --help")
    else:
        #for gui all errors/output will go in null 
       # os.system(f"{command} > /dev/null 2>&1")
        os.system(f"{command} 2> /dev/null 1>/dev/null")

def github_getting_text(link,selector,indexvalue):
    print("Please Wait....\r",end="")
    URL = link
    try:
        r = requests.get(URL)
        soup = BeautifulSoup(r.content, 'html5lib')
        paras = soup.select(selector)
        #check index value from test file
        return paras[indexvalue].text
    except:
        return "Not loaded because no internet connection"

def tool_writeups():
    print("1) TOOL(about,installation)")
    print("2) Write ups")
    print("3) go back..")
    ask=input("Select an option ->  ")
    return ask


#writeups function
def writeup(writeup_dist,name):
    while True:
        os.system("clear")
        banner.main()
        banner.attack(name)
        #convert dict keys in list(type casting)
        key=list(writeup_dist.keys())
        key.append("go back")
        for i in range(len(key)):
            print(f"{i}) {key[i]}")
        option = input("\n Select an option ->  ")
        #1-9=int kdsjfhgkjds=int X to type cast safely 
        try:
            threading.Thread(target=run_on_browser.main, args=(writeup_dist[key[int(option)]],)).start()
            #a={"a":1,"b":2}
            # print(2)
        except:
            return

#this function check tools installed or not that are not in kali repo.
#it take 3 arguments. 1) name of tool 2) Link of the tool 3) needargs
def which_check(name,link,needargs=False):
    proc = subprocess.Popen([f"which {name}"],stdout=subprocess.PIPE,shell=True)
    (there,nothere)=proc.communicate()
    if there:
        print("\n[+] Installed")
        print("[+] it is installed in your kali\n")
        if needargs:
                download=input("\nDo you want to run the tool?(y/n)")
                if download.lower()=="y" or download.lower()=="yes":
                    #when tool is of cli no need of thread
                    thread_run(name,needargs)
        else:
                download=input("\nDo you want to run the tool?(y/n)")
                if download.lower()=="y" or download.lower()=="yes":
                    #when tool is of gui it needs thread
                    threading.Thread(target=thread_run, args=(name,)).start()
    else:
        print("\n[+] it is not installed in your Kali")    
        download=input("[+] Do you want to install it?(y/n)")
        if download.lower()=="y" or download.lower()=="yes":
            os.system(f"go install {link}")
            # os.system("go install github.com/projectdiscovery/katana/cmd/katana@latest")
            os.system(f'sudo cp ~/go/bin/{name} /usr/bin')
            if needargs:
                download=input("\nDo you want to run the tool?(y/n)")
                if download.lower()=="y" or download.lower()=="yes":
                    #when tool is of cli no need of thread
                    thread_run(name,needargs)
            else:
                download=input("\nDo you want to run the tool?(y/n)")
                if download.lower()=="y" or download.lower()=="yes":
                    #when tool is of gui it needs thread
                    threading.Thread(target=thread_run, args=(name,)).start()
if __name__=='__main__':
    main()
